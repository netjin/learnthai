{% extends "admin/base_admin.html" %}

{% block title %}ä»ªè¡¨æ¿{% endblock %}
{% block page_title %}ä»ªè¡¨æ¿{% endblock %}

{% block content %}
<div class="stats-cards">
    <div class="stat-card">
        <div class="stat-number">{{ stats.total_users }}</div>
        <div class="stat-label">æ€»ç”¨æˆ·æ•°</div>
        <div class="stat-sub">ä»Šæ—¥æ–°å¢ +{{ stats.new_users_today }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.total_vocab }}</div>
        <div class="stat-label">æ€»è¯æ±‡æ•°</div>
        <div class="stat-sub">å·²å¯ç”¨ {{ stats.active_vocab }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.active_users_today }}</div>
        <div class="stat-label">ä»Šæ—¥æ´»è·ƒ</div>
        <div class="stat-sub">ç”¨æˆ·æ•°</div>
    </div>
    <div class="stat-card">
        <div class="stat-number">{{ stats.total_attempts }}</div>
        <div class="stat-label">æ€»ç­”é¢˜æ•°</div>
        <div class="stat-sub">ä»Šæ—¥ +{{ stats.attempts_today }}</div>
    </div>
</div>

<h3 class="section-title">å¯¹è¯å­¦ä¹ </h3>
<div class="stats-cards">
    <div class="stat-card conversation">
        <div class="stat-number">{{ conversation_stats.total_scenes }}</div>
        <div class="stat-label">ğŸ“š å¯¹è¯åœºæ™¯</div>
        <div class="stat-sub">å·²å¯ç”¨ {{ conversation_stats.active_scenes }} ä¸ª</div>
    </div>
    <div class="stat-card conversation">
        <div class="stat-number">{{ conversation_stats.total_conversations }}</div>
        <div class="stat-label">ğŸ’¬ å¯¹è¯å†…å®¹</div>
        <div class="stat-sub">å…± {{ conversation_stats.total_lines }} å¥</div>
    </div>
    <div class="stat-card conversation">
        <div class="stat-number">{{ conversation_stats.total_practices }}</div>
        <div class="stat-label">ğŸ¯ å¯¹è¯ç»ƒä¹ </div>
        <div class="stat-sub">ä»Šæ—¥ +{{ conversation_stats.practices_today }}</div>
    </div>
    <div class="stat-card conversation">
        <div class="stat-number">{{ conversation_stats.users_learned }}</div>
        <div class="stat-label">ğŸ‘¥ å­¦ä¹ äººæ•°</div>
        <div class="stat-sub">ä»Šæ—¥æ´»è·ƒ {{ conversation_stats.users_today }}</div>
    </div>
</div>

<div class="charts-row">
    <div class="chart-card">
        <h3>æ¯æ—¥æ´»è·ƒè¶‹åŠ¿ï¼ˆæœ€è¿‘7å¤©ï¼‰</h3>
        <div class="bar-chart">
            {% set max_count = daily_active|map(attribute='count')|max or 1 %}
            {% for day in daily_active %}
            <div class="bar-item">
                <div class="bar" style="height: {{ (day.count / max_count * 100)|int }}%">
                    <span class="bar-value">{{ day.count }}</span>
                </div>
                <span class="bar-label">{{ day.date }}</span>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="chart-card">
        <h3>è¯æ±‡æŒæ¡åº¦åˆ†å¸ƒ</h3>
        <div class="bar-chart horizontal">
            {% set max_fam = familiarity_dist|map(attribute='count')|max or 1 %}
            {% for item in familiarity_dist %}
            <div class="bar-item-h">
                <span class="bar-label-h">ç­‰çº§ {{ item.level }}</span>
                <div class="bar-h" style="width: {{ (item.count / max_fam * 100)|int }}%">
                    <span class="bar-value-h">{{ item.count }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

<div class="charts-row">
    <div class="chart-card">
        <h3>å¯¹è¯ç†Ÿç»ƒåº¦åˆ†å¸ƒ</h3>
        <div class="bar-chart horizontal">
            {% set max_conv_fam = conversation_familiarity_dist|map(attribute='count')|max or 1 %}
            {% for item in conversation_familiarity_dist %}
            <div class="bar-item-h">
                <span class="bar-label-h">ç­‰çº§ {{ item.level }}</span>
                <div class="bar-h conversation" style="width: {{ (item.count / max_conv_fam * 100)|int }}%">
                    <span class="bar-value-h">{{ item.count }}</span>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <div class="table-card">
        <h3>çƒ­é—¨å¯¹è¯ TOP 5</h3>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>åœºæ™¯</th>
                    <th>å¯¹è¯æ ‡é¢˜</th>
                    <th>éš¾åº¦</th>
                    <th>å­¦ä¹ äººæ•°</th>
                    <th>ç»ƒä¹ æ¬¡æ•°</th>
                </tr>
            </thead>
            <tbody>
                {% for conv in popular_conversations %}
                <tr>
                    <td>{{ conv.scene_name }}</td>
                    <td>{{ conv.title_chinese }}</td>
                    <td>{{ 'â˜…' * conv.difficulty_level }}</td>
                    <td>{{ conv.user_count }}</td>
                    <td>{{ conv.practice_count }}</td>
                </tr>
                {% else %}
                <tr><td colspan="5">æš‚æ— æ•°æ®</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="tables-row">
    <div class="table-card">
        <h3>å›°éš¾è¯æ±‡ TOP 5</h3>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>æ³°è¯­</th>
                    <th>ä¸­æ–‡</th>
                    <th>é”™è¯¯æ¬¡æ•°</th>
                </tr>
            </thead>
            <tbody>
                {% for vocab in difficult_vocab %}
                <tr>
                    <td>{{ vocab.thai_word }}</td>
                    <td>{{ vocab.chinese_meaning }}</td>
                    <td>{{ vocab.wrong or 0 }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3">æš‚æ— æ•°æ®</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="table-card">
        <h3>çƒ­é—¨è¯æ±‡ TOP 5</h3>
        <table class="admin-table">
            <thead>
                <tr>
                    <th>æ³°è¯­</th>
                    <th>ä¸­æ–‡</th>
                    <th>å­¦ä¹ æ¬¡æ•°</th>
                </tr>
            </thead>
            <tbody>
                {% for vocab in popular_vocab %}
                <tr>
                    <td>{{ vocab.thai_word }}</td>
                    <td>{{ vocab.chinese_meaning }}</td>
                    <td>{{ vocab.count }}</td>
                </tr>
                {% else %}
                <tr><td colspan="3">æš‚æ— æ•°æ®</td></tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}
